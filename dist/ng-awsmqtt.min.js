/**
 * ng-awsmqtt
 *
 * @version 0.1.1
 * @author Lei Xu <komushi@gmail.com>
 * @license MIT
 */
!function(a){"use strict";"object"==typeof exports?
// Node/CommonJS
module.exports=a("undefined"!=typeof angular?angular:require("angular"),"undefined"!=typeof AWSMqtt?AWSMqtt:require("aws-mqtt")):"function"==typeof define&&define.amd?
// AMD. Register as an anonymous module.
define(["angular","aws-mqtt"],a):
// Browser globals
a(angular,AWSMqtt)}(function(a,b){a.module("ng-awsmqtt",[]).service("$mqtt",["$rootScope","$q",function(a,c){var d={};this.connect=function(a,e,f,g,h){var i=c.defer();
// mqttClients[name].on('error', function(error) {
//   dfd.reject(error)
// })
return d[a]=b.connect({WebSocket:window.WebSocket,region:f,credentials:{accessKeyId:g,secretAccessKey:h,get:function(a){a()}},endpoint:e,// NOTE: get this value with `aws iot describe-endpoint`
clientId:"mqtt-client-"+Math.floor(1e5*Math.random()+1)}),d[a].on("connect",function(a){i.notify({topic:"connack",message:JSON.stringify(a)})}),d[a].on("message",function(a,b){i.notify({topic:a,message:b})}),i.promise},this.disconnect=function(a){var b=c.defer();return d[a].end(!0,b.resolve),b.promise},this.unsubscribe=function(a,b){var e=c.defer();return d[a]&&d[a].connected&&d[a].unsubscribe(b,function(b){b?e.reject(b):e.resolve({subscribedTopics:d[a]._subscribedTopics})}),e.promise},this.subscribe=function(a,b){var e=c.defer();return d[a]&&d[a].connected&&d[a].subscribe(b,function(b,c){b?e.reject(b):e.resolve({granted:c,subscribedTopics:d[a]._subscribedTopics})}),e.promise},this.send=function(a,b,e){var f=c.defer();try{var g=JSON.stringify(e);d[a].publish(b,g),f.resolve()}catch(h){f.reject(h)}return f.promise}}])});